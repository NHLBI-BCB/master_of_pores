includeConfig "$baseDir/preproc.config"

process {
  memory='4G'
  cache='lenient'
  container = 'biocorecrg/nanopore:0.9'
  containerOptions = { workflow.containerEngine == "docker" ? '-u $(id -u):$(id -g)': null}
  withLabel: big_cpus {
        cpus = 2
        memory = '5G'
  }
  withLabel: big_mem_cpus {
        cpus = 2
        memory = '5G'
  }
  withLabel: basecall_cpus {
        container = 'biocorecrg/npbasecallcpu:0.2'
        cpus = 2
        memory = '5G'
  }
  withLabel: basecall_gpus {
        container = 'biocorecrg/npbasecallgpu:0.3'
        maxForks = 1
        containerOptions = { workflow.containerEngine == "singularity" ? '--nv':
           ( workflow.containerEngine == "docker" ? '-u $(id -u):$(id -g) --gpus all': null ) } 
  } 
}
singularity.cacheDir = "$baseDir/singularity"
singularity.autoMounts = true

profiles {
  
  // Default profile, assumed CRG cluster
  standard {
    queue='biocore-el7,long-sl7,short-sl7'
  }
  
  awsbatch {
    // Your working dir in a S3 bucket
    workDir = 's3://frankfurt-nf/work'
    process.executor = 'awsbatch'
    // replace with gspot for GPU nodes
    process.queue = 'spot'
    // Path below depends on the launch image
    aws.batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
    // Used region. Notice not all regions have the same node types
    aws.region = 'eu-central-1'
    docker.enabled = true
  }
  

}